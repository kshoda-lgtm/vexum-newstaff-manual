# 研修課題：出退勤打刻アプリ開発

## 📋 課題内容

スマートフォンから**ワンタップで出退勤を打刻**し、管理者のLINEグループに自動通知するアプリを開発してください。
完成したら**「課題完了ボタン」**を押すと管理者に通知が届き、確認後に合格判定されます。

### 提出期限
**1週間後**

### 必須機能
1. ✅ 出勤打刻（ボタン押下でLINE通知）
2. ✅ 退勤打刻（勤務時間を自動計算してLINE通知）
3. ✅ 課題完了報告（管理者に通知）
4. ✅ PWA対応（ホーム画面に追加可能）

---

## 🛠️ 実装手順

### STEP 1: Googleスプレッドシート作成

1. 新規スプレッドシート作成
   - ファイル名：「出退勤管理_[あなたの名前]」

2. **シート1：研修生マスタ**

| A列 | B列 | C列 |
|-----|-----|-----|
| 研修生ID | 氏名 | ステータス |
| user01 | あなたの名前 | 進行中 |

3. **シート2：打刻記録**

| A列 | B列 | C列 | D列 | E列 | F列 |
|-----|-----|-----|-----|-----|-----|
| 日付 | 研修生ID | 氏名 | 出勤時刻 | 退勤時刻 | 勤務時間 |

4. **シート3：課題完了記録**

| A列 | B列 | C列 | D列 | E列 |
|-----|-----|-----|-----|-----|
| 完了日時 | 研修生ID | 氏名 | アプリURL | 判定 |

5. スプレッドシートIDをコピー
   - URLの`/d/`と`/edit`の間の文字列

---

### STEP 2: GAS（Google Apps Script）実装

1. スプレッドシートのメニュー → 「拡張機能」 → 「Apps Script」

2. 以下のコードを貼り付け（既存コードは削除）

```javascript
// ========== 設定項目 ==========
const CHANNEL_ACCESS_TOKEN = 'YOZ7UftinQaO3OyBDaloYu4cXzhYtLzmqBzAGNvCIJRg7h+DoqsX0n6OXdfOFZ9vI7/+VIOKgdWLHJ6yBmeAi6kPqz4+FZ3vpHQTBEAQSHA81c9tQLH/8oP8UUyRpnHxvmJ0QlaAjZWiraJeO38tBgdB04t89/1O/w1cDnyilFU=';
const GROUP_ID = 'C5a5b36e27a78ed6cfbb74839a8a9d04e';
const SPREADSHEET_ID = 'ここにあなたのスプレッドシートIDを貼り付け';

// ========== メイン処理 ==========
function doPost(e) {
  try {
    const params = JSON.parse(e.postData.contents);
    const userId = params.userId;
    const action = params.action;

    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const masterSheet = ss.getSheetByName('研修生マスタ');
    const recordSheet = ss.getSheetByName('打刻記録');
    const completeSheet = ss.getSheetByName('課題完了記録');

    // 研修生名を取得
    const staffData = masterSheet.getDataRange().getValues();
    let staffName = '不明';
    for (let i = 1; i < staffData.length; i++) {
      if (staffData[i][0].toString() == userId) {
        staffName = staffData[i][1];
        break;
      }
    }

    const now = new Date();
    const dateStr = Utilities.formatDate(now, 'JST', 'yyyy/MM/dd');
    const timeStr = Utilities.formatDate(now, 'JST', 'HH:mm');
    const fullTime = Utilities.formatDate(now, 'JST', 'yyyy/MM/dd HH:mm');

    // 課題完了報告
    if (action === 'complete') {
      completeSheet.appendRow([fullTime, userId, staffName, params.appUrl || '', '確認待ち']);
      masterSheet.getRange(2, 3).setValue('完了');

      const message = `【🎉課題完了報告🎉】\n研修生：${staffName}（${userId}）\n完了：${fullTime}\n\nアプリURL:\n${params.appUrl}\n\n確認をお願いします！`;
      sendToLine(message);
      return ContentService.createTextOutput(JSON.stringify({
        status: 'success',
        message: '完了報告を送信しました！'
      })).setMimeType(ContentService.MimeType.JSON);
    }

    // 出勤打刻
    if (action === 'in') {
      recordSheet.appendRow([dateStr, userId, staffName, timeStr, '', '']);
      sendToLine(`【出勤】\n${staffName}\n${dateStr} ${timeStr}`);
    }

    // 退勤打刻
    if (action === 'out') {
      const records = recordSheet.getDataRange().getValues();
      for (let i = records.length - 1; i >= 1; i--) {
        if (records[i][0] == dateStr && records[i][1] == userId && records[i][4] == '') {
          const inTime = records[i][3];
          recordSheet.getRange(i + 1, 5).setValue(timeStr);
          const workHours = calculateWorkHours(inTime, timeStr);
          recordSheet.getRange(i + 1, 6).setValue(workHours);
          sendToLine(`【退勤】\n${staffName}\n出勤：${inTime}\n退勤：${timeStr}\n勤務：${workHours}`);
          break;
        }
      }
    }

    return ContentService.createTextOutput(JSON.stringify({status: 'success'}))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      status: 'error',
      message: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function calculateWorkHours(inTime, outTime) {
  const [inH, inM] = inTime.split(':').map(Number);
  const [outH, outM] = outTime.split(':').map(Number);
  const diff = (outH * 60 + outM) - (inH * 60 + inM);
  return `${Math.floor(diff / 60)}時間${diff % 60}分`;
}

function sendToLine(text) {
  UrlFetchApp.fetch('https://api.line.me/v2/bot/message/push', {
    method: 'post',
    contentType: 'application/json',
    headers: { 'Authorization': 'Bearer ' + CHANNEL_ACCESS_TOKEN },
    payload: JSON.stringify({
      to: GROUP_ID,
      messages: [{ type: 'text', text: text }]
    })
  });
}
```

3. 「デプロイ」 → 「新しいデプロイ」
   - 種類：ウェブアプリ
   - アクセス権限：**全員**
   - デプロイ

4. **ウェブアプリのURL**をコピー（後で使う）

---

### STEP 3: フロントエンド実装

#### 1. フォルダ作成
デスクトップに「出退勤アプリ」フォルダを作成

#### 2. index.html 作成
メモ帳に以下を貼り付け、`index.html`として保存

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#4CAF50">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <title>出退勤打刻</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
    }
    h1 { text-align: center; color: #333; margin-bottom: 30px; }
    .user { text-align: center; margin: 20px 0; font-weight: bold; color: #666; }
    .status {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 8px;
      color: #666;
    }
    .btn {
      width: 100%;
      padding: 20px;
      border: none;
      border-radius: 12px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 0;
      color: white;
      transition: transform 0.2s;
    }
    .btn:active { transform: scale(0.95); }
    .btn-in { background: linear-gradient(135deg, #667eea, #764ba2); }
    .btn-out { background: linear-gradient(135deg, #f093fb, #f5576c); }
    .btn-complete { background: linear-gradient(135deg, #ffd89b, #19547b); }
    .link { text-align: center; margin-top: 20px; }
    .link a { color: #667eea; text-decoration: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>📱 出退勤打刻</h1>
    <div id="user" class="user"></div>
    <div id="status" class="status">準備完了</div>

    <button class="btn btn-in" onclick="punch('in')">🏢 出勤</button>
    <button class="btn btn-out" onclick="punch('out')">🏠 退勤</button>
    <button class="btn btn-complete" onclick="complete()">🎉 課題完了報告</button>

    <div class="link"><a href="#" onclick="changeId()">IDを変更</a></div>
  </div>

  <script>
    const GAS_URL = 'ここにSTEP2でコピーしたGASのURLを貼り付け';

    window.onload = function() {
      let id = localStorage.getItem('userId');
      if (!id) {
        id = prompt('研修生ID を入力（例：user01）');
        if (id) localStorage.setItem('userId', id);
      }
      document.getElementById('user').textContent = `ID: ${id}`;
    };

    function punch(action) {
      const id = localStorage.getItem('userId');
      if (!id) { alert('IDが未設定'); return; }

      const type = action === 'in' ? '出勤' : '退勤';
      document.getElementById('status').textContent = `${type}打刻中...`;

      fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({ userId: id, action: action })
      })
      .then(r => r.json())
      .then(d => {
        document.getElementById('status').textContent =
          d.status === 'success' ? `✅ ${type}完了` : `❌ エラー`;
        setTimeout(() => {
          document.getElementById('status').textContent = '準備完了';
        }, 3000);
      });
    }

    function complete() {
      const id = localStorage.getItem('userId');
      if (!id) { alert('IDが未設定'); return; }
      if (!confirm('課題完了報告を送信しますか？')) return;

      fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({
          userId: id,
          action: 'complete',
          appUrl: window.location.href
        })
      })
      .then(r => r.json())
      .then(d => {
        alert(d.status === 'success' ?
          '🎉 完了報告送信！\n管理者の確認をお待ちください' :
          `エラー: ${d.message}`);
      });
    }

    function changeId() {
      const id = prompt('新しいIDを入力');
      if (id) {
        localStorage.setItem('userId', id);
        document.getElementById('user').textContent = `ID: ${id}`;
      }
    }
  </script>
</body>
</html>
```

#### 3. manifest.json 作成
```json
{
  "short_name": "出退勤",
  "name": "出退勤打刻",
  "icons": [{"src": "icon.png", "sizes": "192x192", "type": "image/png"}],
  "start_url": ".",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#4CAF50"
}
```

#### 4. icon.png をダウンロード
適当な192x192pxのアイコン画像を用意して`icon.png`として保存

---

### STEP 4: GitHubで公開

1. GitHubで新規リポジトリ作成
   - リポジトリ名：`attendance-app-[あなたの名前]`
   - Public設定

2. 3つのファイルをアップロード
   - index.html
   - manifest.json
   - icon.png

3. Settings → Pages
   - Branch: main
   - Save

4. 発行されたURLにアクセスして動作確認

---

## 📱 スマホでの使い方

1. Chromeでアプリを開く
2. メニュー（︙） → 「ホーム画面に追加」
3. 初回起動時に研修生IDを入力
4. 出勤・退勤ボタンで打刻
5. **完成したら「課題完了報告」ボタンを押す**

---

## ✅ 合格基準

### 必須（全て動作すること）
- [ ] 出勤ボタンでLINE通知が届く
- [ ] 退勤ボタンで勤務時間が計算される
- [ ] スプレッドシートに記録される
- [ ] 課題完了ボタンで管理者に通知が届く
- [ ] PWAとしてインストールできる

### 加点ポイント
- デザインの工夫
- エラーハンドリング
- コードの可読性

---

## 🚨 トラブルシューティング

| 問題 | 解決方法 |
|------|---------|
| LINE通知が届かない | GASの設定（トークン・グループID）を確認 |
| 打刻が記録されない | スプレッドシートのシート名を確認 |
| スマホで動かない | Chromeで開いているか確認 |
| 課題完了ボタンが反応しない | GAS URLが正しいか確認 |

---

## 📝 提出方法

**アプリ内の「🎉課題完了報告」ボタンを押すだけ！**

管理者のLINEに通知が届き、確認後に合格判定されます。

---

**頑張ってください！ 💪**
