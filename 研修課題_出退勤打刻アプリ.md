# ç ”ä¿®èª²é¡Œï¼šå‡ºé€€å‹¤æ‰“åˆ»ã‚¢ãƒ—ãƒªé–‹ç™º

## ğŸ“‹ èª²é¡Œå†…å®¹

ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‹ã‚‰**ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ã§å‡ºé€€å‹¤ã‚’æ‰“åˆ»**ã—ã€ç®¡ç†è€…ã®LINEã‚°ãƒ«ãƒ¼ãƒ—ã«è‡ªå‹•é€šçŸ¥ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’é–‹ç™ºã—ã¦ãã ã•ã„ã€‚
å®Œæˆã—ãŸã‚‰**ã€Œèª²é¡Œå®Œäº†ãƒœã‚¿ãƒ³ã€**ã‚’æŠ¼ã™ã¨ç®¡ç†è€…ã«é€šçŸ¥ãŒå±Šãã€ç¢ºèªå¾Œã«åˆæ ¼åˆ¤å®šã•ã‚Œã¾ã™ã€‚

### æå‡ºæœŸé™
**1é€±é–“å¾Œ**

### å¿…é ˆæ©Ÿèƒ½
1. âœ… å‡ºå‹¤æ‰“åˆ»ï¼ˆãƒœã‚¿ãƒ³æŠ¼ä¸‹ã§LINEé€šçŸ¥ï¼‰
2. âœ… é€€å‹¤æ‰“åˆ»ï¼ˆå‹¤å‹™æ™‚é–“ã‚’è‡ªå‹•è¨ˆç®—ã—ã¦LINEé€šçŸ¥ï¼‰
3. âœ… èª²é¡Œå®Œäº†å ±å‘Šï¼ˆç®¡ç†è€…ã«é€šçŸ¥ï¼‰
4. âœ… PWAå¯¾å¿œï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ å¯èƒ½ï¼‰

---

## ğŸ› ï¸ å®Ÿè£…æ‰‹é †

### STEP 1: Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ

1. æ–°è¦ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆä½œæˆ
   - ãƒ•ã‚¡ã‚¤ãƒ«åï¼šã€Œå‡ºé€€å‹¤ç®¡ç†_[ã‚ãªãŸã®åå‰]ã€

2. **ã‚·ãƒ¼ãƒˆ1ï¼šç ”ä¿®ç”Ÿãƒã‚¹ã‚¿**

| Aåˆ— | Båˆ— | Cåˆ— |
|-----|-----|-----|
| ç ”ä¿®ç”ŸID | æ°å | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ |
| user01 | ã‚ãªãŸã®åå‰ | é€²è¡Œä¸­ |

3. **ã‚·ãƒ¼ãƒˆ2ï¼šæ‰“åˆ»è¨˜éŒ²**

| Aåˆ— | Båˆ— | Cåˆ— | Dåˆ— | Eåˆ— | Fåˆ— |
|-----|-----|-----|-----|-----|-----|
| æ—¥ä»˜ | ç ”ä¿®ç”ŸID | æ°å | å‡ºå‹¤æ™‚åˆ» | é€€å‹¤æ™‚åˆ» | å‹¤å‹™æ™‚é–“ |

4. **ã‚·ãƒ¼ãƒˆ3ï¼šèª²é¡Œå®Œäº†è¨˜éŒ²**

| Aåˆ— | Båˆ— | Cåˆ— | Dåˆ— | Eåˆ— |
|-----|-----|-----|-----|-----|
| å®Œäº†æ—¥æ™‚ | ç ”ä¿®ç”ŸID | æ°å | ã‚¢ãƒ—ãƒªURL | åˆ¤å®š |

5. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’ã‚³ãƒ”ãƒ¼
   - URLã®`/d/`ã¨`/edit`ã®é–“ã®æ–‡å­—åˆ—

---

### STEP 2: GASï¼ˆGoogle Apps Scriptï¼‰å®Ÿè£…

1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â†’ ã€Œæ‹¡å¼µæ©Ÿèƒ½ã€ â†’ ã€ŒApps Scriptã€

2. ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¯å‰Šé™¤ï¼‰

```javascript
// ========== è¨­å®šé …ç›® ==========
const CHANNEL_ACCESS_TOKEN = 'YOZ7UftinQaO3OyBDaloYu4cXzhYtLzmqBzAGNvCIJRg7h+DoqsX0n6OXdfOFZ9vI7/+VIOKgdWLHJ6yBmeAi6kPqz4+FZ3vpHQTBEAQSHA81c9tQLH/8oP8UUyRpnHxvmJ0QlaAjZWiraJeO38tBgdB04t89/1O/w1cDnyilFU=';
const GROUP_ID = 'C5a5b36e27a78ed6cfbb74839a8a9d04e';
const SPREADSHEET_ID = 'ã“ã“ã«ã‚ãªãŸã®ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆIDã‚’è²¼ã‚Šä»˜ã‘';

// ========== ãƒ¡ã‚¤ãƒ³å‡¦ç† ==========
function doPost(e) {
  try {
    const params = JSON.parse(e.postData.contents);
    const userId = params.userId;
    const action = params.action;

    const ss = SpreadsheetApp.openById(SPREADSHEET_ID);
    const masterSheet = ss.getSheetByName('ç ”ä¿®ç”Ÿãƒã‚¹ã‚¿');
    const recordSheet = ss.getSheetByName('æ‰“åˆ»è¨˜éŒ²');
    const completeSheet = ss.getSheetByName('èª²é¡Œå®Œäº†è¨˜éŒ²');

    // ç ”ä¿®ç”Ÿåã‚’å–å¾—
    const staffData = masterSheet.getDataRange().getValues();
    let staffName = 'ä¸æ˜';
    for (let i = 1; i < staffData.length; i++) {
      if (staffData[i][0].toString() == userId) {
        staffName = staffData[i][1];
        break;
      }
    }

    const now = new Date();
    const dateStr = Utilities.formatDate(now, 'JST', 'yyyy/MM/dd');
    const timeStr = Utilities.formatDate(now, 'JST', 'HH:mm');
    const fullTime = Utilities.formatDate(now, 'JST', 'yyyy/MM/dd HH:mm');

    // èª²é¡Œå®Œäº†å ±å‘Š
    if (action === 'complete') {
      completeSheet.appendRow([fullTime, userId, staffName, params.appUrl || '', 'ç¢ºèªå¾…ã¡']);
      masterSheet.getRange(2, 3).setValue('å®Œäº†');

      const message = `ã€ğŸ‰èª²é¡Œå®Œäº†å ±å‘ŠğŸ‰ã€‘\nç ”ä¿®ç”Ÿï¼š${staffName}ï¼ˆ${userId}ï¼‰\nå®Œäº†ï¼š${fullTime}\n\nã‚¢ãƒ—ãƒªURL:\n${params.appUrl}\n\nç¢ºèªã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼`;
      sendToLine(message);
      return ContentService.createTextOutput(JSON.stringify({
        status: 'success',
        message: 'å®Œäº†å ±å‘Šã‚’é€ä¿¡ã—ã¾ã—ãŸï¼'
      })).setMimeType(ContentService.MimeType.JSON);
    }

    // å‡ºå‹¤æ‰“åˆ»
    if (action === 'in') {
      recordSheet.appendRow([dateStr, userId, staffName, timeStr, '', '']);
      sendToLine(`ã€å‡ºå‹¤ã€‘\n${staffName}\n${dateStr} ${timeStr}`);
    }

    // é€€å‹¤æ‰“åˆ»
    if (action === 'out') {
      const records = recordSheet.getDataRange().getValues();
      for (let i = records.length - 1; i >= 1; i--) {
        if (records[i][0] == dateStr && records[i][1] == userId && records[i][4] == '') {
          const inTime = records[i][3];
          recordSheet.getRange(i + 1, 5).setValue(timeStr);
          const workHours = calculateWorkHours(inTime, timeStr);
          recordSheet.getRange(i + 1, 6).setValue(workHours);
          sendToLine(`ã€é€€å‹¤ã€‘\n${staffName}\nå‡ºå‹¤ï¼š${inTime}\né€€å‹¤ï¼š${timeStr}\nå‹¤å‹™ï¼š${workHours}`);
          break;
        }
      }
    }

    return ContentService.createTextOutput(JSON.stringify({status: 'success'}))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      status: 'error',
      message: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function calculateWorkHours(inTime, outTime) {
  const [inH, inM] = inTime.split(':').map(Number);
  const [outH, outM] = outTime.split(':').map(Number);
  const diff = (outH * 60 + outM) - (inH * 60 + inM);
  return `${Math.floor(diff / 60)}æ™‚é–“${diff % 60}åˆ†`;
}

function sendToLine(text) {
  UrlFetchApp.fetch('https://api.line.me/v2/bot/message/push', {
    method: 'post',
    contentType: 'application/json',
    headers: { 'Authorization': 'Bearer ' + CHANNEL_ACCESS_TOKEN },
    payload: JSON.stringify({
      to: GROUP_ID,
      messages: [{ type: 'text', text: text }]
    })
  });
}
```

3. ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€ â†’ ã€Œæ–°ã—ã„ãƒ‡ãƒ—ãƒ­ã‚¤ã€
   - ç¨®é¡ï¼šã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒª
   - ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ï¼š**å…¨å“¡**
   - ãƒ‡ãƒ—ãƒ­ã‚¤

4. **ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªã®URL**ã‚’ã‚³ãƒ”ãƒ¼ï¼ˆå¾Œã§ä½¿ã†ï¼‰

---

### STEP 3: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å®Ÿè£…

#### 1. ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆ
ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«ã€Œå‡ºé€€å‹¤ã‚¢ãƒ—ãƒªã€ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆ

#### 2. index.html ä½œæˆ
ãƒ¡ãƒ¢å¸³ã«ä»¥ä¸‹ã‚’è²¼ã‚Šä»˜ã‘ã€`index.html`ã¨ã—ã¦ä¿å­˜

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#4CAF50">
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon.png">
  <title>å‡ºé€€å‹¤æ‰“åˆ»</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    .container {
      background: white;
      border-radius: 20px;
      padding: 40px 30px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 400px;
      width: 100%;
    }
    h1 { text-align: center; color: #333; margin-bottom: 30px; }
    .user { text-align: center; margin: 20px 0; font-weight: bold; color: #666; }
    .status {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: #f5f5f5;
      border-radius: 8px;
      color: #666;
    }
    .btn {
      width: 100%;
      padding: 20px;
      border: none;
      border-radius: 12px;
      font-size: 20px;
      font-weight: bold;
      cursor: pointer;
      margin: 10px 0;
      color: white;
      transition: transform 0.2s;
    }
    .btn:active { transform: scale(0.95); }
    .btn-in { background: linear-gradient(135deg, #667eea, #764ba2); }
    .btn-out { background: linear-gradient(135deg, #f093fb, #f5576c); }
    .btn-complete { background: linear-gradient(135deg, #ffd89b, #19547b); }
    .link { text-align: center; margin-top: 20px; }
    .link a { color: #667eea; text-decoration: none; }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“± å‡ºé€€å‹¤æ‰“åˆ»</h1>
    <div id="user" class="user"></div>
    <div id="status" class="status">æº–å‚™å®Œäº†</div>

    <button class="btn btn-in" onclick="punch('in')">ğŸ¢ å‡ºå‹¤</button>
    <button class="btn btn-out" onclick="punch('out')">ğŸ  é€€å‹¤</button>
    <button class="btn btn-complete" onclick="complete()">ğŸ‰ èª²é¡Œå®Œäº†å ±å‘Š</button>

    <div class="link"><a href="#" onclick="changeId()">IDã‚’å¤‰æ›´</a></div>
  </div>

  <script>
    const GAS_URL = 'ã“ã“ã«STEP2ã§ã‚³ãƒ”ãƒ¼ã—ãŸGASã®URLã‚’è²¼ã‚Šä»˜ã‘';

    window.onload = function() {
      let id = localStorage.getItem('userId');
      if (!id) {
        id = prompt('ç ”ä¿®ç”ŸID ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šuser01ï¼‰');
        if (id) localStorage.setItem('userId', id);
      }
      document.getElementById('user').textContent = `ID: ${id}`;
    };

    function punch(action) {
      const id = localStorage.getItem('userId');
      if (!id) { alert('IDãŒæœªè¨­å®š'); return; }

      const type = action === 'in' ? 'å‡ºå‹¤' : 'é€€å‹¤';
      document.getElementById('status').textContent = `${type}æ‰“åˆ»ä¸­...`;

      fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({ userId: id, action: action })
      })
      .then(r => r.json())
      .then(d => {
        document.getElementById('status').textContent =
          d.status === 'success' ? `âœ… ${type}å®Œäº†` : `âŒ ã‚¨ãƒ©ãƒ¼`;
        setTimeout(() => {
          document.getElementById('status').textContent = 'æº–å‚™å®Œäº†';
        }, 3000);
      });
    }

    function complete() {
      const id = localStorage.getItem('userId');
      if (!id) { alert('IDãŒæœªè¨­å®š'); return; }
      if (!confirm('èª²é¡Œå®Œäº†å ±å‘Šã‚’é€ä¿¡ã—ã¾ã™ã‹ï¼Ÿ')) return;

      fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify({
          userId: id,
          action: 'complete',
          appUrl: window.location.href
        })
      })
      .then(r => r.json())
      .then(d => {
        alert(d.status === 'success' ?
          'ğŸ‰ å®Œäº†å ±å‘Šé€ä¿¡ï¼\nç®¡ç†è€…ã®ç¢ºèªã‚’ãŠå¾…ã¡ãã ã•ã„' :
          `ã‚¨ãƒ©ãƒ¼: ${d.message}`);
      });
    }

    function changeId() {
      const id = prompt('æ–°ã—ã„IDã‚’å…¥åŠ›');
      if (id) {
        localStorage.setItem('userId', id);
        document.getElementById('user').textContent = `ID: ${id}`;
      }
    }
  </script>
</body>
</html>
```

#### 3. manifest.json ä½œæˆ
```json
{
  "short_name": "å‡ºé€€å‹¤",
  "name": "å‡ºé€€å‹¤æ‰“åˆ»",
  "icons": [{"src": "icon.png", "sizes": "192x192", "type": "image/png"}],
  "start_url": ".",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#4CAF50"
}
```

#### 4. icon.png ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
é©å½“ãª192x192pxã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚’ç”¨æ„ã—ã¦`icon.png`ã¨ã—ã¦ä¿å­˜

---

### STEP 4: GitHubã§å…¬é–‹

1. GitHubã§æ–°è¦ãƒªãƒã‚¸ãƒˆãƒªä½œæˆ
   - ãƒªãƒã‚¸ãƒˆãƒªåï¼š`attendance-app-[ã‚ãªãŸã®åå‰]`
   - Publicè¨­å®š

2. 3ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - index.html
   - manifest.json
   - icon.png

3. Settings â†’ Pages
   - Branch: main
   - Save

4. ç™ºè¡Œã•ã‚ŒãŸURLã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦å‹•ä½œç¢ºèª

---

## ğŸ“± ã‚¹ãƒãƒ›ã§ã®ä½¿ã„æ–¹

1. Chromeã§ã‚¢ãƒ—ãƒªã‚’é–‹ã
2. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆï¸™ï¼‰ â†’ ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€
3. åˆå›èµ·å‹•æ™‚ã«ç ”ä¿®ç”ŸIDã‚’å…¥åŠ›
4. å‡ºå‹¤ãƒ»é€€å‹¤ãƒœã‚¿ãƒ³ã§æ‰“åˆ»
5. **å®Œæˆã—ãŸã‚‰ã€Œèª²é¡Œå®Œäº†å ±å‘Šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™**

---

## âœ… åˆæ ¼åŸºæº–

### å¿…é ˆï¼ˆå…¨ã¦å‹•ä½œã™ã‚‹ã“ã¨ï¼‰
- [ ] å‡ºå‹¤ãƒœã‚¿ãƒ³ã§LINEé€šçŸ¥ãŒå±Šã
- [ ] é€€å‹¤ãƒœã‚¿ãƒ³ã§å‹¤å‹™æ™‚é–“ãŒè¨ˆç®—ã•ã‚Œã‚‹
- [ ] ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¨˜éŒ²ã•ã‚Œã‚‹
- [ ] èª²é¡Œå®Œäº†ãƒœã‚¿ãƒ³ã§ç®¡ç†è€…ã«é€šçŸ¥ãŒå±Šã
- [ ] PWAã¨ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹

### åŠ ç‚¹ãƒã‚¤ãƒ³ãƒˆ
- ãƒ‡ã‚¶ã‚¤ãƒ³ã®å·¥å¤«
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- ã‚³ãƒ¼ãƒ‰ã®å¯èª­æ€§

---

## ğŸš¨ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| å•é¡Œ | è§£æ±ºæ–¹æ³• |
|------|---------|
| LINEé€šçŸ¥ãŒå±Šã‹ãªã„ | GASã®è¨­å®šï¼ˆãƒˆãƒ¼ã‚¯ãƒ³ãƒ»ã‚°ãƒ«ãƒ¼ãƒ—IDï¼‰ã‚’ç¢ºèª |
| æ‰“åˆ»ãŒè¨˜éŒ²ã•ã‚Œãªã„ | ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®ã‚·ãƒ¼ãƒˆåã‚’ç¢ºèª |
| ã‚¹ãƒãƒ›ã§å‹•ã‹ãªã„ | Chromeã§é–‹ã„ã¦ã„ã‚‹ã‹ç¢ºèª |
| èª²é¡Œå®Œäº†ãƒœã‚¿ãƒ³ãŒåå¿œã—ãªã„ | GAS URLãŒæ­£ã—ã„ã‹ç¢ºèª |

---

## ğŸ“ æå‡ºæ–¹æ³•

**ã‚¢ãƒ—ãƒªå†…ã®ã€ŒğŸ‰èª²é¡Œå®Œäº†å ±å‘Šã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ï¼**

ç®¡ç†è€…ã®LINEã«é€šçŸ¥ãŒå±Šãã€ç¢ºèªå¾Œã«åˆæ ¼åˆ¤å®šã•ã‚Œã¾ã™ã€‚

---

**é ‘å¼µã£ã¦ãã ã•ã„ï¼ ğŸ’ª**
